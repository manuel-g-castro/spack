--- a/qe-6.8/archive/fox/configure	2015-12-24 06:28:29.000000000 +0900
+++ b/qe-6.8/archive/fox/configure	2020-02-21 22:08:54.000000000 +0900
@@ -565,7 +565,7 @@ ac_default_prefix=/usr/local
 ac_clean_files=
 ac_config_libobj_dir=.
 LIBOBJS=
-cross_compiling=no
+cross_compiling=yes
 subdirs=
 MFLAGS=
 MAKEFLAGS=
--- a/qe-6.8/archive/lapack-3.6.1/Makefile	2016-06-19 07:15:11.000000000 +0900
+++ b/qe-6.8/archive/lapack-3.6.1/Makefile	2020-02-21 22:08:13.000000000 +0900
@@ -14,8 +14,7 @@ lib: lapacklib tmglib
 clean: cleanlib cleantesting cleanblas_testing cleancblas_testing
 
 lapack_install:
-	( cd INSTALL; $(MAKE); ./testlsame; ./testslamch; ./testdlamch; \
-	./testsecond; ./testdsecnd; ./testieee; ./testversion )
+	( cd INSTALL; $(MAKE) )
 
 blaslib:
 	( cd BLAS/SRC; $(MAKE) )
--- a/qe-6.8/install/extlibs_makefile	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/install/extlibs_makefile	2020-02-21 22:10:30.000000000 +0900
@@ -59,7 +59,7 @@ libfox:
         mkdir ../FoX; \
 	(gzip -dc ../archive/fox.tgz | (cd ../FoX; tar -xvf -)); \
 	cd ../FoX/fox/; export FC=$(F90); export FCFLAGS="$(FOX_FLAGS)"; \
-	./configure --prefix=$(TOPDIR)/FoX ;\
+	env CPPFLAGS= ./configure --prefix=$(TOPDIR)/FoX ;\
     touch cp_test; \
     if cp -p cp_test cp_test_1; then \
         echo "cp -p works"; \
@@ -105,7 +105,8 @@ libcuda_devxlib :
                 --with-cuda-cc=$(GPU_ARCH) \
                 --with-cuda-runtime=$(CUDA_RUNTIME) \
                 --disable-parallel \
-                --enable-cuda-env-check=no; \
+                --enable-cuda-env-check=no \
+                --host=arm-linux-gnu; \
     make all
 	touch ../install/libcuda_devxlib # do not download and configure again
 
@@ -128,7 +129,7 @@ libmbd:
 	(gzip -dc ../archive/libmbd-0.10.3.tar.gz | (cd ../MBD; tar -xvf -)); \
 	(gzip -dc ../archive/libmbd-0.10.3-non-cmake-makefiles.tar.gz | (cd ../MBD; tar -xvf -)); \
 	cd ../MBD/libmbd-0.10.3/src; export FXX=$(F90); export FXXOPT="$(F90FLAGS)"; \
-	cp serial.make Makefile; $(MAKE) ; cp *.mod *.a ../..; cd ../.. ;fi
+	cp serial.make Makefile; $(MAKE) LIBMBD_C_API=0; cp *.mod *.a ../..; cd ../.. ;fi
 
 libmbd_clean:
 	if test -d ../MBD; then (rm -R -f ../MBD); fi
--- a/qe-6.8/install/configure	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/install/configure	2019-12-23 15:35:52.776469882 +0900
@@ -3261,6 +3261,7 @@ case "$arch" in
 $as_echo "$as_me: WARNING: parallel and serial compiler are the same" >&2;}
 	   fi
 	fi
+    f90_in_mpif90=$F90
 	f90=$f90_in_mpif90
         ;;
 esac
--- a/qe-6.8/PHonon/PH/elphon.f90	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/PHonon/PH/elphon.f90	2019-12-23 16:59:01.321628438 +0900
@@ -796,7 +796,8 @@ SUBROUTINE elphsum ( )
   CALL start_clock('elphsum')
 
   elph_dir='elph_dir/'
-  IF (ionode) INQUIRE(file=TRIM(elph_dir), EXIST=exst)
+!  IF (ionode) INQUIRE(file=TRIM(elph_dir), EXIST=exst)
+  exst= .FALSE.
   CALL mp_bcast(exst, ionode_id, intra_image_comm) 
   IF (.NOT.exst) CALL create_directory( elph_dir )
   WRITE (6, '(5x,"electron-phonon interaction  ..."/)')
--- a/qe-6.8/EPW/src/low_lvl.f90	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/EPW/src/low_lvl.f90	2020-01-10 11:57:21.000000000 +0900
@@ -735,10 +735,10 @@
     !!
     LOGICAL :: ifxst
     !! Does the file exists
-#if defined(__PGI) || defined(__CRAY) || defined(__XLF) || defined(__FLANG)
+!!#if defined(__PGI) || defined(__CRAY) || defined(__XLF) || defined(__FLANG)
     INTEGER, EXTERNAL :: getpid
     !! PID of the process
-#endif
+!!#endif
     INTEGER :: pid
     !! PID of the process
     !
--- a/qe-6.8/test-suite/run-ph.sh	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/test-suite/run-ph.sh	2020-04-16 09:23:32.000000000 +0900
@@ -21,7 +21,7 @@ if [[ "$1" == "1" ]]
 then
   echo "Running PW ..."
 # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -30,7 +30,7 @@ elif [[ "$1" == "2" ]]
 then
   echo "Running PH ..."
 # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -39,7 +39,7 @@ elif [[ "$1" == "3" ]]
 then
   echo "Running Q2R ..."
 # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/q2r.x < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/q2r.x < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/q2r.x -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -48,7 +48,7 @@ elif [[ "$1" == "4" ]]
 then
   echo "Running MATDYN ..."
 # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/matdyn.x < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/matdyn.x < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/matdyn.x -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -66,7 +66,7 @@ elif [[ "$1" == "6" ]]
 then
   echo "Running DVSCF_Q2R ..."
 # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/dvscf_q2r.x < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/dvscf_q2r.x < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/dvscf_q2r.x -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -75,7 +75,7 @@ elif [[ "$1" == "7" ]]
 then
   echo "Running POSTAHC ..."
 # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/postahc.x < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/postahc.x < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/postahc.x -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
--- a/qe-6.8/test-suite/run-hp.sh	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/test-suite/run-hp.sh	2020-04-16 09:22:18.000000000 +0900
@@ -21,8 +21,8 @@ echo $0" "$@
 if [[ "$1" == "1" ]]
 then
   echo "Running PW ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x -input $2 > $3 2> $4"
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -31,8 +31,8 @@ then
 elif [[ "$1" == "2" ]]
 then
   echo "Running PW ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -41,8 +41,8 @@ then
 elif [[ "$1" == "3" ]]
 then
   echo "Running HP ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x -input $2 > $3 2> $4
   cp *.Hubbard_parameters.dat $3
   if [[ -e CRASH ]]
   then
@@ -52,8 +52,8 @@ then
 elif [[ "$1" == "4" ]]
 then
   echo "Running HP ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/hp.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   cp *.Hubbard_parameters.dat $3
   if [[ -e CRASH ]]
   then
--- a/qe-6.8/test-suite/run-tddfpt.sh	2019-12-07 02:58:08.000000000 +0900
+++ b/qe-6.8/test-suite/run-tddfpt.sh	2020-04-16 09:25:29.000000000 +0900
@@ -20,8 +20,8 @@ echo $0" "$@
 if [[ "$1" == "1" ]]
 then
   echo "Running PW ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4"
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -29,8 +29,8 @@ then
 elif [[ "$1" == "2" ]]
 then
   echo "Running TURBO LANCZOS ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_lanczos.x < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_lanczos.x < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_lanczos.x -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_lanczos.x -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -38,8 +38,8 @@ then
 elif [[ "$1" == "3" ]]
 then
   echo "Running TURBO SPECTRUM CHI ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   cp $3 turbo_spectrum.out
   cp *.plot_chi.dat $3
   if [[ -e CRASH ]]
@@ -49,8 +49,8 @@ then
 elif [[ "$1" == "4" ]]
 then
   echo "Running TURBO SPECTRUM EELS ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_spectrum.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   cp $3 turbo_spectrum.out
   cp *.plot_eps.dat $3
   if [[ -e CRASH ]]
@@ -60,8 +60,8 @@ then
 elif [[ "$1" == "5" ]]
 then
   echo "Running TURBO EELS ..."
-  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_eels.x ${PARA_SUFFIX} < $2 > $3 2> $4"  
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_eels.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_eels.x ${PARA_SUFFIX} -input $2 > $3 2> $4"  
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/turbo_eels.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
--- a/qe-6.8/test-suite/run-pw.sh     2021-11-01 09:20:41.000000000 +0900
+++ b/qe-6.8/test-suite/run-pw.sh     2021-11-01 09:23:42.000000000 +0900
@@ -19,8 +19,8 @@
 if [[ "$1" == "1" ]]
 then
   echo "Running PW ..."
-# echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4"
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -28,8 +28,8 @@
 elif [[ "$1" == "2" ]]
 then
   echo "Running PW ..."
-# echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} < $2 > $3 2> $4"
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  # echo "${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} -input $2 > $3 2> $4"
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ph.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
--- a/qe-6.8/test-suite/run-pp.sh     2021-11-01 09:18:39.000000000 +0900
+++ b/qe-6.8/test-suite/run-pp.sh     2021-11-01 09:27:58.000000000 +0900
@@ -19,7 +19,7 @@
 if [[ "$1" == "1" ]]
 then
   # echo "Running PW ..."
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/pw.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
@@ -27,7 +27,7 @@
 elif [[ "$1" == "2" ]]
 then
   # echo "Running PP ..."
-  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ppacf.x ${PARA_SUFFIX} < $2 > $3 2> $4
+  ${PARA_PREFIX} ${ESPRESSO_ROOT}/bin/ppacf.x ${PARA_SUFFIX} -input $2 > $3 2> $4
   if [[ -e CRASH ]]
   then
     cat $3
--- a/qe-6.8/EPW/src/epw_readin.f90	2020-08-05 17:55:18.000000000 +0900
+++ b/qe-6.8/EPW/src/epw_readin.f90	2020-08-13 16:09:13.000000000 +0900
@@ -632,7 +632,7 @@
     ENDIF
     IF (ios2 /= 0) CALL errore('epw_readin', 'Could not find namelist &inputepw', 2)
     IF (ios /= 0) THEN
-      CALL errore('epw_readin', 'Bad line in namelist &inputepw'&
+      CALL errore('epw_readin', 'Bad line in namelist &inputepw' // &
                  ': "'//TRIM(line)//'" (error could be in the previous line)', 1)
     ENDIF
     ios = close_input_file ( )
--- a/qe-6.8/PHonon/PH/ahc.f90	2020-08-05 17:55:18.000000000 +0900
+++ b/qe-6.8/PHonon/PH/ahc.f90	2020-08-14 15:15:13.000000000 +0900
@@ -997,7 +997,8 @@ SUBROUTINE elph_ahc_setup()
   !
   ! Create output directory
   !
-  IF (ionode) INQUIRE(FILE=TRIM(ahc_dir), EXIST=exst)
+  ! IF (ionode) INQUIRE(FILE=TRIM(ahc_dir), EXIST=exst)
+  exst = .false.
   CALL mp_bcast(exst, ionode_id, intra_image_comm)
   IF (.NOT. exst) CALL create_directory(ahc_dir)
   !
--- a/qe-6.8/PHonon/PH/openfilq.f90	2020-08-05 17:55:18.000000000 +0900
+++ b/qe-6.8/PHonon/PH/openfilq.f90	2020-08-28 11:46:51.256621091 +0900
@@ -55,6 +55,8 @@ SUBROUTINE openfilq()
   USE dvscf_interpolate, ONLY : ldvscf_interpolate, nrbase, nrlocal, &
                                 wpot_dir, iunwpot, lrwpot
   USE ahc,              ONLY : elph_ahc, ahc_nbnd_gauge
+  USE mp,              ONLY : mp_barrier
+  USE mp_world,        ONLY : world_comm
   !
   IMPLICIT NONE
   !
@@ -168,6 +170,13 @@ SUBROUTINE openfilq()
 
   IF (((trans.AND.(start_irr/=0.OR.last_irr/=0)).OR.elph).AND..NOT.xmldyn) THEN
      iudyn = 26
+     IF(elph.AND.(.NOT.trans)) THEN
+         IF(ionode) THEN
+             OPEN (iudyn, file=fildyn, status='unknown')
+             CLOSE(iudyn)
+         ENDIF
+         CALL mp_barrier(world_comm)
+     ENDIF
      OPEN (unit=iudyn, file=fildyn, status='unknown', err=100, iostat=ios)
 100  CALL errore ('openfilq', 'opening file'//fildyn, ABS (ios) )
      REWIND (iudyn)
--- a/qe-6.8/test-suite/pw_scf/scf-ppcg-k.in	2021-07-19 18:11:06.000000000 +0900
+++ b/qe-6.8/test-suite/pw_scf/scf-ppcg-k.in	2021-08-13 15:47:51.000000000 +0900
@@ -10,7 +10,7 @@
  /
  &electrons
   diagonalization='ppcg',
-  conv_thr=1.0e-15
+  conv_thr=1.0e-9
  /
 ATOMIC_SPECIES
  Si  28.086  Si.pbe-rrkj.UPF   
--- a/qe-6.8/test-suite/pw_uspp/uspp-ppcg-k.in	2021-07-19 18:11:06.000000000 +0900
+++ b/qe-6.8/test-suite/pw_uspp/uspp-ppcg-k.in	2021-08-13 15:48:24.000000000 +0900
@@ -10,7 +10,7 @@
  /
  &electrons
   diagonalization='ppcg',
-  conv_thr=1.0e-15
+  conv_thr=1.0e-9
  /
 ATOMIC_SPECIES
  Si  28.086  Si.pbe-nl-rrkjus_psl.1.0.0.UPF   
